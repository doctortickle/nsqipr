testthat::test_that("make_reop_long works", {
  x <- data.table::data.table(caseid = c(1,2,3,4),reoperation1 = c(TRUE, TRUE, FALSE, NA),retorpodays = c(10, 7, NA, NA),reoporcpt1 = c("44005", "37211", NA, NA),retorrelated = c(TRUE, TRUE, NA, NA),reoporicd91 = c("K56.69","T82.868A", NA, NA),reopor1icd101 = c("K56.59", "T82.868A", NA, NA),reoperation2 = c(TRUE, TRUE, FALSE, NA),retor2podays = c(10, 7, NA, NA),reopor2cpt1 = c("44005", "37211", NA, NA),retor2related = c(TRUE, TRUE, NA, NA),reopor2icd91 = c("K56.69","T82.868A", NA, NA),reopor2icd101 = c("K56.59", "T82.868A", NA, NA),reoperation3 = c(TRUE, TRUE, FALSE, NA),retor3podays = c(10, 7, NA, NA),reopor3cpt1 = c("44005", "37211", NA, NA),retor3related = c(TRUE, TRUE, NA, NA),reopor3icd91 = c("K56.69","T82.868A", NA, NA),reopor3icd101 = c("K56.59", "T82.868A", NA, NA))
  y <- data.table::data.table(caseid = c(1, 1, 1, 2, 2, 2, 3, 3, 3), nreoperation = c(1L, 2L, 3L, 1L, 2L, 3L, 1L, 2L, 3L), reoperation = c(TRUE,TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE), retorpodays = c(10, 10, 10, 7, 7, 7, NA, NA, NA), reoporcpt = c("44005", "44005", "44005", "37211", "37211", "37211", NA, NA, NA), retorrelated = c(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, NA, NA, NA), reoporicd9 = c("K56.69", "K56.69", "K56.69", "T82.868A", "T82.868A", "T82.868A", NA, NA, NA), reoporicd10 = c("K56.59", "K56.59", "K56.59", "T82.868A", "T82.868A", "T82.868A", NA, NA, NA))
  testthat::expect_equal(make_reop_long(x), y)
  testthat::expect_equal(make_reop_long(x, TRUE), y[-7:-9, ])
  testthat::expect_null(make_reop_long(data.table::data.table()))
})

testthat::test_that("make_readm_long works", {
  x <- data.table::data.table(caseid = c(1,2,3,4),readmission1 = c(TRUE, TRUE, FALSE, NA),readmpodays1 = c(10, 7, NA, NA),readmrelated1 = c(TRUE, FALSE, NA, NA),readmsuspreason1 = c("Reason", "Reason", NA, NA),readmrelicd91 = c("111", "222", NA, NA),readmrelicd101 = c("1111","2222", NA, NA),unplannedreadmission1 = c(TRUE, FALSE, NA, NA),readmunrelsusp1 = c("Reason", NA, NA, NA),readmunrelicd91 = c("111", NA, NA, NA),readmunrelicd101 = c("1111",NA,NA,NA),readmission2 = c(TRUE, TRUE, FALSE, NA),readmpodays2 = c(10, 7, NA, NA),readmrelated2 = c(TRUE, FALSE, NA, NA),readmsuspreason2 = c("Reason", "Reason", NA, NA),readmrelicd92 = c("111", "222", NA, NA),readmrelicd102 = c("1111","2222", NA, NA),unplannedreadmission2 = c(TRUE, FALSE, NA, NA),readmunrelsusp2 = c("Reason", NA, NA, NA),readmunrelicd92 = c("111", NA, NA, NA),readmunrelicd102 = c("1111",NA,NA,NA),readmission3 = c(TRUE, TRUE, FALSE, NA),readmpodays3 = c(10, 7, NA, NA),readmrelated3 = c(TRUE, FALSE, NA, NA),readmsuspreason3 = c("Reason", "Reason", NA, NA),readmrelicd93 = c("111", "222", NA, NA),readmrelicd103 = c("1111","2222", NA, NA),unplannedreadmission3 = c(TRUE, FALSE, NA, NA),readmunrelsusp3 = c("Reason", NA, NA, NA),readmunrelicd93 = c("111", NA, NA, NA),readmunrelicd103 = c("1111",NA,NA,NA),readmission4 = c(TRUE, TRUE, FALSE, NA),readmpodays4 = c(10, 7, NA, NA),readmrelated4 = c(TRUE, FALSE, NA, NA),readmsuspreason4 = c("Reason", "Reason", NA, NA),readmrelicd94 = c("111", "222", NA, NA),readmrelicd104 = c("1111","2222", NA, NA),unplannedreadmission4 = c(TRUE, FALSE, NA, NA),readmunrelsusp4 = c("Reason", NA, NA, NA),readmunrelicd94 = c("111", NA, NA, NA),readmunrelicd104 = c("1111",NA,NA,NA),readmission5 = c(TRUE, TRUE, FALSE, NA),readmpodays5 = c(10, 7, NA, NA),readmrelated5 = c(TRUE, FALSE, NA, NA),readmsuspreason5 = c("Reason", "Reason", NA, NA),readmrelicd95 = c("111", "222", NA, NA),readmrelicd105 = c("1111","2222", NA, NA),unplannedreadmission5 = c(TRUE, FALSE, NA, NA),readmunrelsusp5 = c("Reason", NA, NA, NA),readmunrelicd95 = c("111", NA, NA, NA),readmunrelicd105 = c("1111",NA,NA,NA))
  y <- data.table::data.table(caseid = c(1, 1, 1, 1, 1, 2, 2, 2, 2, 2, 3, 3, 3, 3, 3), nreadmission = c(1L, 2L, 3L, 4L, 5L, 1L, 2L, 3L, 4L, 5L, 1L, 2L, 3L, 4L, 5L), readmission = c(TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE), readmpodays = c(10, 10, 10, 10, 10, 7, 7, 7, 7, 7, NA, NA, NA, NA, NA), readmrelated = c(TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, NA, NA, NA, NA, NA), readmsuspreason = c("Reason", "Reason", "Reason", "Reason", "Reason", "Reason", "Reason", "Reason", "Reason", "Reason", NA, NA, NA, NA, NA), readmrelicd9 = c("111", "111", "111", "111", "111", "222", "222", "222", "222", "222", NA, NA, NA, NA, NA), readmrelicd10 = c("1111", "1111", "1111", "1111", "1111", "2222", "2222", "2222", "2222", "2222", NA, NA, NA, NA, NA), unplannedreadmission = c(TRUE, TRUE, TRUE, TRUE, TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, NA, NA, NA, NA, NA), readmunrelsusp = c("Reason", "Reason", "Reason", "Reason", "Reason", NA, NA, NA, NA, NA, NA, NA, NA, NA, NA), readmunrelicd9 = c("111", "111", "111", "111", "111", NA, NA,  NA, NA, NA, NA, NA, NA, NA, NA), readmunrelicd10 = c("1111", "1111", "1111", "1111", "1111", NA, NA, NA, NA, NA, NA, NA, NA, NA, NA))
  testthat::expect_equal(make_readm_long(x), y)
  testthat::expect_equal(make_readm_long(x, TRUE), y[-11:-15, ])
  testthat::expect_null(make_readm_long(data.table::data.table()))
})

testthat::test_that("make_anesthes_other_long works", {
  x <- data.table::data.table(caseid = c(1,2,3,4), anesthes_other = c("General","General, Spinal", "General, Spinal, MAC/IV Sedation", NA), anesthes_other1 = c("General", "General", "General", NA), anesthes_other2 = c(NA, "Spinal", "Spinal", NA), anesthes_other3 = c(NA, NA, "MAC/IV Sedation", NA), anesthes_other4 = c(NA, NA, NA, NA), anesthes_other5 = c(NA, NA, NA, NA), anesthes_other6 = c(NA, NA, NA, NA), anesthes_other7 = c(NA, NA, NA, NA),
anesthes_other8 = c(NA, NA, NA, NA))
  y <- data.table::data.table(caseid = c(1, 2, 2, 3, 3, 3), nanesthes_other = c(1L, 1L, 2L, 1L, 2L, 3L), anesthes_other = c("General", "General", "Spinal", "General", "Spinal", "MAC/IV Sedation"))
  testthat::expect_equal(make_anesthes_other_long(x), y)
  testthat::expect_null(make_anesthes_other_long(data.table::data.table()))
})
